<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <title>Street Challenge · Player 2 (Student)</title>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <link href="/css/player2.css" rel="stylesheet">
  
   <!-- New Theme 2 code Load the new v2 CSS only when ?theme=v2 -->
  <script>
    (function () {
      const params = new URLSearchParams(location.search);
      if (params.get('theme') === 'v2') {
        const link = document.createElement('link');
        link.rel = 'stylesheet';
        link.href = '/css/player2_v2.css?v=dev1';
        document.head.appendChild(link);
      }
    })();
  </script>
   <!-- New Theme 2 code Load the new v2 CSS only when ?theme=v2 -->
</head>
<body>
  <header class="site-header">
    <div class="brand">
      <span class="logo">CC</span>
      <span class="title">Street Challenge</span>
      <span class="role">Player</span>
    </div>
  </header>

  <main class="wrap">
    <!-- ===== Step 1: Lobby (Join only) ===== -->
    <section id="lobby" class="card">
      <h2 class="card-title">Lobby</h2>
      <div class="form-grid">
        <label class="label">Your Name</label>
        <input id="username" class="input" placeholder="Enter your name"/>
        <label class="label">Room Code</label>
        <input id="roomInput" class="input" placeholder="ABC123" maxlength="8"/>
        <div class="btn-row"><button id="joinBtn" class="btn btn-primary">Join</button></div>
        <p class="small muted">If opened via QR, the room may be pre-filled.</p>
      </div>
    </section>

    <!-- ===== Step 2: Stage (visible after Join) ===== -->
    <section id="stage" class="hidden">
      <!-- Waiting -->
      <section id="greeting" class="card">
        <h2 class="card-title">Waiting for the host…</h2>
        <div class="btn-row"><button id="exitOnline" class="btn">Back</button></div>
      </section>

      <!-- Live Votes (Audience) -->
      <div class="card" id="voteChartCard" style="display:none; margin-top:16px;">
  <div class="vote-chart">
    <div class="chart-title">Live Voting Results</div>
    <div class="chart-container">
      <!-- True 柱 -->
      <div class="chart-bar-wrapper">
        <div class="chart-label">👍 True</div>
        <div class="chart-bar-bg">
          <div id="barTrue" class="chart-bar chart-bar-true" style="height:0%">
            <span class="chart-value" id="valueTrue">0</span>
          </div>
        </div>
        <div class="chart-count" id="countTrue">0 votes</div>
      </div>
      
      <!-- False 柱 -->
      <div class="chart-bar-wrapper">
        <div class="chart-label">👎 False</div>
        <div class="chart-bar-bg">
          <div id="barFalse" class="chart-bar chart-bar-false" style="height:0%">
            <span class="chart-value" id="valueFalse">0</span>
          </div>
        </div>
        <div class="chart-count" id="countFalse">0 votes</div>
      </div>
    </div>
    
    <!-- 统计信息 -->
    <div class="chart-stats" id="voteStats">
      Total: 0 votes | True: 0% | False: 0%
    </div>
  </div>
</div>

      <!-- Live · Short Answer -->
      <section id="shortAnswer" class="card hidden">
        <h2 class="card-title">
          Live · Short Answer
          <span id="qNo2a" class="small muted" style="margin-left:8px">Q — / —</span>
        </h2>
        <div class="qtext" id="question">—</div>
        <form id="shortanswers" class="form-grid">
          <input id="answer" class="input" placeholder="Type your answer…"/>
          <div class="progress"><div id="sTimerBar1" class="progress-bar"></div></div>
          <div class="timer-text">Time left: <span id="timer" class="mono"></span></div>
          <div class="btn-row">
            <button type="submit" class="btn btn-primary">Submit</button>
            <button id="exitOnline2" type="button" class="btn">Back</button>
          </div>
        </form>
      </section>

      <!-- Live · True / False -->
      <section id="trueOrFalse" class="card hidden">
        <h2 class="card-title">
          Live · True / False
          <span id="qNo2b" class="small muted" style="margin-left:8px">Q — / —</span>
        </h2>
        <div class="qtext" id="tfquestion">—</div>
        <form id="tfanswers" class="form-grid">
          <div class="radio-row">
            <label class="radio"><input type="radio" name="tfanswer" value="true"/> True</label>
            <label class="radio"><input type="radio" name="tfanswer" value="false"/> False</label>
          </div>
          <div class="progress"><div id="sTimerBar2" class="progress-bar"></div></div>
          <div class="timer-text">Time left: <span id="timer2" class="mono"></span></div>
          <div class="btn-row">
            <button type="submit" class="btn btn-primary">Submit</button>
            <button id="exitOnline3" type="button" class="btn">Back</button>
          </div>
        </form>
      </section>

      <!-- Feedback -->
      <section id="feedbackCard" class="card hidden">
        <h2 class="card-title">Result</h2>
        <div id="result" class="badge">—</div>
        <p id="answertext" class="muted">—</p>
      </section>

      <!-- ⭐ 新增：Completion Card -->
      <section id="completionCard" class="card hidden completion-card">
        <div class="completion-header">
          <h1 class="completion-title">🎉 Quiz Completed!</h1>
          <p id="completionMsg" class="completion-message">Congratulations! You have completed the quiz!</p>
        </div>

        <div class="card" style="margin-top:20px; background: #fff;">
          <h2 class="card-title">🏆 Final Leaderboard</h2>
          <div class="table-wrap">
            <table id="completionLeaderboard" class="table">
              <thead>
                <tr>
                  <th>#</th>
                  <th>Name</th>
                  <th>Score</th>
                  <th>Correct</th>
                  <th>Avg(s)</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>

        <p class="small muted" style="margin-top:16px; text-align:center;">
          Thank you for participating! The host may start a new round.
        </p>
      </section>
    </section>
  </main>

  <!-- libs -->
  <script src="/socket.io/socket.io.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/jquery@3.7.1/dist/jquery.min.js"></script>
  <script src="/env.js"></script>
  <!-- module -->
  <script type="module" src="/js/player2.js"></script>
</body>
</html>