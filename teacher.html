<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Classroom Collaboration · Teacher</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>
    <link href="/css/teacher.css" rel="stylesheet">
  </head>
  <body>
    <header class="site-header">
      <div class="brand">
        <span class="logo">CC</span>
        <span class="title">Classroom Collaboration</span>
        <span class="role">Teacher</span>
      </div>
    </header>

    <main class="wrap">
      <!-- 永久练习房间码 -->
      <section class="card" id="permCard">
        <h2 class="card-title">Permanent Practice Room</h2>
        <div class="room-grid">
          <div>
            <p class="muted">Students can always join practice with this code (no teacher required).</p>
            <div class="room-row">
              <div class="input room-input mono" id="permCode" style="display:flex;align-items:center;justify-content:center;"></div>
              <button id="copyPerm" class="btn">Copy Code</button>
            </div>
            <p class="muted small">Join URL: <span id="permUrl">—</span></p>
          </div>
          <div class="qr-box"><canvas id="qrPermCanvas" width="160" height="160"></canvas></div>
        </div>
      </section>

      <!-- 临时房间（在线出题用） -->
      <section class="card" id="roomCard">
        <h2 class="card-title">Room & QR (Online Questions)</h2>
        <div class="room-grid">
          <div>
            <label class="label" for="roomCode">Room Code</label>
            <div class="room-row">
              <input class="input room-input" id="roomCode" maxlength="8" placeholder="e.g. ABC123">
              <button id="genRoom" class="btn">Generate</button>
              <button id="applyRoom" class="btn btn-primary">Apply</button>
            </div>
            <p class="muted">Students can join via code <b id="roomCodeText">—</b> or scan the QR.</p>
            <p class="muted small">Join URL: <span id="joinUrl">—</span></p>
          </div>
          <div class="qr-box"><canvas id="qrCanvas" width="160" height="160"></canvas></div>
        </div>
      </section>

      <!-- 题库管理（查看 / 删除 / 批删） -->
      <section class="card">
        <h2 class="card-title">Question Bank Manager <span class="muted small">(<span id="bankCount">0</span> items)</span></h2>

        <div class="toolbar">
          <input id="bankSearch" class="input search" placeholder="Search in question / answer / id …">
          <div class="btn-row">
            <button id="refreshBank" class="btn">Refresh</button>
            <button id="deleteSelected" class="btn warn">Delete Selected</button>
          </div>
        </div>

        <div class="table-wrap">
          <table class="table" id="bankTable">
            <thead>
              <tr>
                <th style="width:36px"><input type="checkbox" id="selectAll"></th>
                <th style="width:90px">Type</th>
                <th>Question</th>
                <th style="width:200px">Answer</th>
                <th class="mono" style="width:200px">ID</th>
                <th style="width:90px">Actions</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

        <p id="bankMsg" class="muted small"></p>

        <h3 style="margin-top:16px;">Add Question</h3>
        <form id="bankForm" class="form-grid">
          <label class="label">Type</label>
          <div class="radio-row">
            <label class="radio"><input type="radio" name="bkType" value="short" checked> Short</label>
            <label class="radio"><input type="radio" name="bkType" value="truefalse"> True/False</label>
          </div>
          <label class="label" for="bkQ">Question</label>
          <input id="bkQ" class="input" placeholder="Question text" required>
          <label class="label" for="bkA">Answer</label>
          <input id="bkA" class="input" placeholder='For TF use "true" or "false"' required>
          <div class="btn-row"><button class="btn btn-primary" type="submit">Add to Bank</button></div>
        </form>
      </section>

      <!-- 在线出题 -->
      <section id="gameSelection" class="card">
        <h2 class="card-title">Select a question type (Online)</h2>
        <div class="btn-row">
          <button id="shortAnswer" class="btn btn-primary">Short Answer</button>
          <button id="trueFalse" class="btn">True / False</button>
        </div>
      </section>

      <section id="short" class="card hidden" aria-hidden="true">
        <h2 class="card-title">Short Answer</h2>
        <form id="shortQuestion" class="form-grid" action="">
          <label class="label" for="question">Question</label>
          <input class="input" type="text" id="question" required>
          <label class="label" for="answer">Correct Answer</label>
          <input class="input" type="text" id="answer" required>
          <label class="label" for="timeLimit">Time Limit</label>
          <input class="range" type="range" step="5" min="10" max="90" id="timeLimit" value="30">
          <div class="btn-row"><input id="submit" class="btn btn-primary" type="submit" value="Send Question"></div>
        </form>
      </section>

      <section id="truefalse" class="card hidden" aria-hidden="true">
        <h2 class="card-title">True / False</h2>
        <form id="trueFalseQuestion" class="form-grid" action="">
          <label class="label" for="tfquestion">Question</label>
          <input class="input" type="text" id="tfquestion" required>
          <span class="label">Correct Answer</span>
          <div class="radio-row">
            <label class="radio"><input type="radio" name="tfanswer" value="true"> True</label>
            <label class="radio"><input type="radio" name="tfanswer" value="false"> False</label>
          </div>
          <label class="label" for="tftimeLimit">Time Limit</label>
          <input class="range" type="range" step="5" min="10" max="90" id="tftimeLimit" value="30">
          <div class="btn-row"><input id="tfsubmit" class="btn btn-primary" type="submit" value="Send Question"></div>
        </form>
      </section>

      <!-- 统计 & 排行榜 -->
      <section id="gameSummary" class="card hidden" aria-live="polite">
        <div class="summary-header">
          <h2 class="card-title">Live Summary</h2>
          <button id="reset" class="btn">Submit Another Question</button>
        </div>

        <div class="stats">
          <div class="stat"><div class="stat-value" id="totalAnswers">0</div><div class="stat-label">Total</div></div>
          <div class="stat ok"><div class="stat-value" id="correctAnswers">0</div><div class="stat-label">Correct</div></div>
          <div class="stat warn"><div class="stat-value" id="incorrectAnswers">0</div><div class="stat-label">Incorrect</div></div>
          <div class="stat pill"><div class="stat-value" id="correctAverage">0%</div><div class="stat-label">Accuracy</div></div>
        </div>

        <h3 style="margin-top:12px;">Leaderboard</h3>
        <table class="table" id="leaderboard">
          <thead><tr><th>#</th><th>User</th><th>Score</th><th>Correct</th><th>Avg Time (s)</th></tr></thead>
          <tbody></tbody>
        </table>

        <div class="progress"><div id="timerBar" class="progress-bar" style="width:0%"></div></div>
        <p id="timer" class="timer-text"></p>
      </section>
    </main>

    <script src="/socket.io/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/qrcode@1.5.3/build/qrcode.min.js"></script>
    <script src="/js/teacher.js"></script>
  </body>
</html>
